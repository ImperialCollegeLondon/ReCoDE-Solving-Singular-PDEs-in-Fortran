# 2 - Breaking up the problem

The first step in building any PDE solver is to break the problem down into manageable steps. By breaking down a PDE solver into these steps, the overall process becomes more structured, efficient, and easier to understand. It also facilitates debugging, optimization, and extension. Here, we will break our problem down into its core steps and briefly discuss the techniques used in each step. These steps also form the most important modules in the solver.


Consider the equation discussed in [1.theory.md](https://github.com/ImperialCollegeLondon/ReCoDE-Solving-Singular-PDEs-in-Fortran/blob/2-documentation-set-up/notebooks/1.theory.md), 
namely
$$\frac{\partial u }{\partial t} = \epsilon \left(\frac{\partial^2 u}{\partial x^2} + \frac{\partial^2 u}{\partial x^2} \right) + F(u,v),
\quad 
 \frac{\partial v }{\partial t}=  \left(\frac{\partial^2 v}{\partial x^2}+ \frac{\partial^2 v}{\partial y^2} \right) + G(u,v), $$
then we can break this equation down into more managable steps.


  - ### Step 1:
    In one spatial dimension $x$, consider the boundary value problem (BVP) with solution $u(x)$: 
        $$A(x) \frac{\partial^2 u}{\partial x^2}+B(x) \frac{\partial u}{\partial x}+C(x) u  = D(x) $$
    Where $A(x), B(x), C(x)$ and $D(x)$ are functions. Supplemented with Dirichlet or Neumann bounary conditions.
We will solve this problem by discretising the equation using [finite differences](https://en.wikipedia.org/wiki/Finite_difference_method) to turn the differential equation into an algebraic one with matrices.
    This will involve inverting a matrix which we will achieve with the linear algerba package [LAPACK](https://www.netlib.org/lapack/).
    Solving such equations are described in [this](https://github.com/ImperialCollegeLondon/ReCoDE_Diffusion_Code/blob/main/docs/1-numerics.md) examplar, but we will list the important steps here:
  
  1. Preproscessing:
     - Using `reader.f90` we read in the specified input data
     - Using `domain.f90` we build the uniform computational grids for the problem
     - With `equations/definitions.f90` we then specify the equations we are solving, with boundary conditions
  2. Discretisation:
     - In `equations.f90` the problem is then spatially discretised into discrete algebraic equations using finite differences
     - Both the left and right hand side of the equation above need to be asssembled, including any boundary conditions
  3. Solution:
       


  - ### Step 2:
    We then consider the effect of multiplying the second derivative by a small parameter:
        $$\epsilon A(x) \frac{\partial^2 u}{\partial x^2}+B(x) \frac{\partial u}{\partial x}+C(x) u  = D(x).$$
    The mathematics of this and how this is implemented will be discussed in [9.nonuniform_domain.md](https://github.com/ImperialCollegeLondon/ReCoDE-Solving-Singular-PDEs-in-Fortran/blob/2-documentation-set-up/notebooks/9.nonuniform_domain.md).

  - ### Step 3:
    We then add in the non-linearities, by including the non-linear function $F$:
       $$\epsilon A(x) \frac{\partial^2 u}{\partial x^2}+B(x) \frac{\partial u}{\partial x}+C(x) u + F(u) = D(x). $$
    This is solved via Newton-Iteration, discussed in [10.newton_iteration.md](https://github.com/ImperialCollegeLondon/ReCoDE-Solving-Singular-PDEs-in-Fortran/blob/2-documentation-set-up/notebooks/10.newton_iteration.md).

- ### Step 4:
  We then add a second equation for $v$:
       $$\epsilon A_1(x) \frac{\partial^2 u}{\partial x^2}+B_1(x) \frac{\partial u}{\partial x}+C_1(x) u + F(u,v) = D_1(x), \quad \epsilon A_2(x) \frac{\partial^2 v}{\partial x^2}+B_2(x) \frac{\partial v}{\partial x}+C_2(x) u + G(u,v) = D_2(x). $$ This is easy to implement with finite differences: if our discretised solution was originally $u = (u(x_1),u(x_2),...,u(x_n))$ then the new discretised solution gets written in the form $u = (u(x_1),v(x_1),u(x_2),v(x_2),...,u(x_n),v(x_n)).$ 

- ### Step 5:
  Include a second spatial domain $y$:
       $$\epsilon A_1(x,y) (\frac{\partial^2 u}{\partial x^2}+\frac{\partial^2 u}{\partial y^2}) + C_1(x,y) u + F(u,v) = D_1(x,y), \quad \epsilon A_2(x,y) (\frac{\partial^2 v}{\partial x^2}+\frac{\partial^2 v}{\partial y^2}) + C_2(x,y) v + G(u,v) = D_2(x,y).$$ We have dropped the first derivatives here for simplicity. This 
    
